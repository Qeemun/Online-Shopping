<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é”€å”®ç®¡ç†é¢æ¿</title>
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/animations.css">
    <style>
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .dashboard-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        }
        
        .card-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        .card-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .card-description {
            color: #666;
            margin-bottom: 15px;
        }
        
        .card-link {
            display: inline-block;
            background: var(--primary-color);
            color: white;
            padding: 10px 15px;
            border-radius: 4px;
            text-decoration: none;
            transition: background 0.3s;
        }
        
        .card-link:hover {
            background: var(--primary-dark);
        }
        
        .summary-section {
            margin-bottom: 30px;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .welcome-message {
            margin-bottom: 20px;
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header>
        <h1>é”€å”®ç®¡ç†é¢æ¿</h1>
        <nav>
            <a href="index.html">è¿”å›é¦–é¡µ</a>
            <button id="logout-btn" onclick="logout()">é€€å‡ºç™»å½•</button>
        </nav>
    </header>

    <!-- Welcome Section -->
    <section class="summary-section">
        <div class="welcome-message">
            <h2>æ¬¢è¿ï¼Œ<span id="user-name">é”€å”®å‘˜</span></h2>
            <p>ä»Šå¤©æ˜¯ <span id="current-date"></span></p>
        </div>
        <div id="sales-summary">
            <h3>é”€å”®æ¦‚è§ˆ</h3>
            <div class="stats-grid" id="summary-stats">
                <!-- é”€å”®ç»Ÿè®¡æ•°æ®å°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
                <p>åŠ è½½ä¸­...</p>
            </div>
        </div>
    </section>

    <!-- Sales Dashboard Section -->
    <section id="sales-dashboard">
        <h2>ç®¡ç†åŠŸèƒ½</h2>
        <div class="dashboard-cards">
            <div class="dashboard-card">
                <div class="card-icon">ğŸ“Š</div>
                <div class="card-title">å•†å“é”€å”®ç»Ÿè®¡</div>
                <div class="card-description">æŸ¥çœ‹æ‚¨è´Ÿè´£å•†å“çš„é”€å”®ç»Ÿè®¡æ•°æ®å’Œè¶‹åŠ¿åˆ†æ</div>
                <a href="productSalesReport.html" class="card-link">æŸ¥çœ‹ç»Ÿè®¡</a>
            </div>
            
            <div class="dashboard-card">
                <div class="card-icon">ğŸ“¦</div>
                <div class="card-title">å•†å“ç®¡ç†</div>
                <div class="card-description">ç®¡ç†æ‚¨è´Ÿè´£çš„å•†å“ä¿¡æ¯ã€ä»·æ ¼å’Œåº“å­˜</div>
                <a href="productManagement.html" class="card-link">ç®¡ç†å•†å“</a>
            </div>
            
            <div class="dashboard-card">
                <div class="card-icon">ğŸ”</div>
                <div class="card-title">é”€å”®ç›‘æ§</div>
                <div class="card-description">å®æ—¶ç›‘æ§å•†å“é”€å”®çŠ¶æ€å’Œåº“å­˜æƒ…å†µ</div>
                <a href="productSalesMonitor.html" class="card-link">æŸ¥çœ‹ç›‘æ§</a>
            </div>
            
            <div class="dashboard-card">
                <div class="card-icon">ğŸ“</div>
                <div class="card-title">å•†å“ç›®å½•ç®¡ç†</div>
                <div class="card-description">ç®¡ç†å•†å“ç±»åˆ«å’Œåˆ†ç±»ç›®å½•</div>
                <a href="categoryManagement.html" class="card-link">ç®¡ç†ç›®å½•</a>
            </div>
            
            <div class="dashboard-card">
                <div class="card-icon">ğŸ“</div>
                <div class="card-title">è®¢å•ç®¡ç†</div>
                <div class="card-description">ç®¡ç†ä¸æ‚¨è´Ÿè´£å•†å“ç›¸å…³çš„è®¢å•</div>
                <a href="orderManagement.html" class="card-link">ç®¡ç†è®¢å•</a>
            </div>
            
            <div class="dashboard-card">
                <div class="card-icon">ğŸ‘¥</div>
                <div class="card-title">å®¢æˆ·æ´»åŠ¨æ—¥å¿—</div>
                <div class="card-description">æŸ¥çœ‹å®¢æˆ·å¯¹æ‚¨è´Ÿè´£å•†å“çš„æµè§ˆå’Œè´­ä¹°è®°å½•</div>
                <a href="customerActivityLogs.html" class="card-link">æŸ¥çœ‹æ—¥å¿—</a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <p>&copy; 2024 ç‰§ç‡•å°ç«™</p>
    </footer>

    <script>
        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', () => {
            // æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€
            checkAuth();
            
            // æ˜¾ç¤ºå½“å‰æ—¥æœŸ
            displayCurrentDate();
            
            // åŠ è½½é”€å”®æ‘˜è¦æ•°æ®
            loadSalesSummary();
        });
        
        // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•ä¸”ä¸ºé”€å”®äººå‘˜
        function checkAuth() {
            const token = localStorage.getItem('token');
            const userStr = localStorage.getItem('user');
            
            if (!token || !userStr) {
                alert('è¯·å…ˆç™»å½•');
                window.location.href = 'login.html';
                return;
            }
            
            const user = JSON.parse(userStr);
            console.log('å½“å‰ç”¨æˆ·è§’è‰²:', user.role); // è°ƒè¯•ä¿¡æ¯
            
            // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ä¸ºé”€å”®äººå‘˜
            if (user.role !== 'sales') {
                alert('æ‚¨æ— æƒè®¿é—®æ­¤é¡µé¢');
                window.location.href = 'index.html';
                return;
            }
            
            // æ˜¾ç¤ºç”¨æˆ·å
            if (user.username) {
                document.getElementById('user-name').textContent = user.username;
            }
        }
        
        // æ˜¾ç¤ºå½“å‰æ—¥æœŸ
        function displayCurrentDate() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
            document.getElementById('current-date').textContent = now.toLocaleDateString('zh-CN', options);
        }
        
        // åŠ è½½é”€å”®æ‘˜è¦æ•°æ®
        function loadSalesSummary() {
            const token = localStorage.getItem('token');
            const userId = localStorage.getItem('userId');
            
            fetch(`/sales-staff/${userId}/summary`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('è·å–é”€å”®æ‘˜è¦å¤±è´¥');
                }
                return response.json();
            })
            .then(data => {
                if (data.success) {
                    displaySalesSummary(data.summary);
                } else {
                    throw new Error(data.message || 'è·å–é”€å”®æ‘˜è¦å¤±è´¥');
                }
            })
            .catch(error => {
                console.error('åŠ è½½é”€å”®æ‘˜è¦å‡ºé”™:', error);
                document.getElementById('summary-stats').innerHTML = '<p>æ— æ³•åŠ è½½é”€å”®æ‘˜è¦æ•°æ®</p>';
            });
        }
        
        // æ˜¾ç¤ºé”€å”®æ‘˜è¦æ•°æ®
        function displaySalesSummary(summary) {
            const summaryStats = document.getElementById('summary-stats');
            
            summaryStats.innerHTML = `
                <div class="stat-card">
                    <div class="label">ä»Šæ—¥é”€å”®é¢</div>
                    <div class="value">Â¥${summary.todayRevenue.toFixed(2)}</div>
                </div>
                <div class="stat-card">
                    <div class="label">æœ¬æœˆé”€å”®é¢</div>
                    <div class="value">Â¥${summary.monthRevenue.toFixed(2)}</div>
                </div>
                <div class="stat-card">
                    <div class="label">è´Ÿè´£å•†å“æ•°</div>
                    <div class="value">${summary.productCount}</div>
                </div>
                <div class="stat-card">
                    <div class="label">å¾…å¤„ç†è®¢å•</div>
                    <div class="value">${summary.pendingOrders}</div>
                </div>
            `;
        }
        
        // é€€å‡ºç™»å½•
        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('userId');
            localStorage.removeItem('userRole');
            localStorage.removeItem('userName');
            window.location.href = 'login.html';
        }
    </script>
</body>

</html>
