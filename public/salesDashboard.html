<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>销售管理面板</title>
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <link rel="stylesheet" href="css/animations.css">
    <style>
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .dashboard-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        }
        
        .card-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        .card-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .card-description {
            color: #666;
            margin-bottom: 15px;
        }
        
        .card-link {
            display: inline-block;
            background: var(--primary-color);
            color: white;
            padding: 10px 15px;
            border-radius: 4px;
            text-decoration: none;
            transition: background 0.3s;
        }
        
        .card-link:hover {
            background: var(--primary-dark);
        }
        
        .summary-section {
            margin-bottom: 30px;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .welcome-message {
            margin-bottom: 20px;
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header>
        <h1>销售管理面板</h1>
        <nav>
            <a href="index.html">返回首页</a>
            <button id="logout-btn" onclick="logout()">退出登录</button>
        </nav>
    </header>

    <!-- Welcome Section -->
    <section class="summary-section">
        <div class="welcome-message">
            <h2>欢迎，<span id="user-name">销售员</span></h2>
            <p>今天是 <span id="current-date"></span></p>
        </div>
        <div id="sales-summary">
            <h3>销售概览</h3>
            <div class="stats-grid" id="summary-stats">
                <!-- 销售统计数据将在这里动态加载 -->
                <p>加载中...</p>
            </div>
        </div>
    </section>

    <!-- Sales Dashboard Section -->
    <section id="sales-dashboard">
        <h2>管理功能</h2>
        <div class="dashboard-cards">
            <div class="dashboard-card">
                <div class="card-icon">📊</div>
                <div class="card-title">商品销售统计</div>
                <div class="card-description">查看您负责商品的销售统计数据和趋势分析</div>
                <a href="productSalesReport.html" class="card-link">查看统计</a>
            </div>
            
            <div class="dashboard-card">
                <div class="card-icon">📦</div>
                <div class="card-title">商品管理</div>
                <div class="card-description">管理您负责的商品信息、价格和库存</div>
                <a href="productManagement.html" class="card-link">管理商品</a>
            </div>
            
            <div class="dashboard-card">
                <div class="card-icon">🔍</div>
                <div class="card-title">销售监控</div>
                <div class="card-description">实时监控商品销售状态和库存情况</div>
                <a href="productSalesMonitor.html" class="card-link">查看监控</a>
            </div>
            
            <div class="dashboard-card">
                <div class="card-icon">📁</div>
                <div class="card-title">商品目录管理</div>
                <div class="card-description">管理商品类别和分类目录</div>
                <a href="categoryManagement.html" class="card-link">管理目录</a>
            </div>
            
            <div class="dashboard-card">
                <div class="card-icon">📝</div>
                <div class="card-title">订单管理</div>
                <div class="card-description">管理与您负责商品相关的订单</div>
                <a href="orderManagement.html" class="card-link">管理订单</a>
            </div>
            
            <div class="dashboard-card">
                <div class="card-icon">👥</div>
                <div class="card-title">客户活动日志</div>
                <div class="card-description">查看客户对您负责商品的浏览和购买记录</div>
                <a href="customerActivityLogs.html" class="card-link">查看日志</a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <p>&copy; 2024 牧燕小站</p>
    </footer>

    <script>
        // 页面加载时执行
        document.addEventListener('DOMContentLoaded', () => {
            // 检查用户登录状态
            checkAuth();
            
            // 显示当前日期
            displayCurrentDate();
            
            // 加载销售摘要数据
            loadSalesSummary();
        });
        
        // 检查用户是否已登录且为销售人员
        function checkAuth() {
            const token = localStorage.getItem('token');
            const userStr = localStorage.getItem('user');
            
            if (!token || !userStr) {
                alert('请先登录');
                window.location.href = 'login.html';
                return;
            }
            
            const user = JSON.parse(userStr);
            console.log('当前用户角色:', user.role); // 调试信息
            
            // 检查用户是否为销售人员
            if (user.role !== 'sales') {
                alert('您无权访问此页面');
                window.location.href = 'index.html';
                return;
            }
            
            // 显示用户名
            if (user.username) {
                document.getElementById('user-name').textContent = user.username;
            }
        }
        
        // 显示当前日期
        function displayCurrentDate() {
            const now = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
            document.getElementById('current-date').textContent = now.toLocaleDateString('zh-CN', options);
        }
        
        // 加载销售摘要数据
        function loadSalesSummary() {
            const token = localStorage.getItem('token');
            const userId = localStorage.getItem('userId');
            
            fetch(`/sales-staff/${userId}/summary`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('获取销售摘要失败');
                }
                return response.json();
            })
            .then(data => {
                if (data.success) {
                    displaySalesSummary(data.summary);
                } else {
                    throw new Error(data.message || '获取销售摘要失败');
                }
            })
            .catch(error => {
                console.error('加载销售摘要出错:', error);
                document.getElementById('summary-stats').innerHTML = '<p>无法加载销售摘要数据</p>';
            });
        }
        
        // 显示销售摘要数据
        function displaySalesSummary(summary) {
            const summaryStats = document.getElementById('summary-stats');
            
            summaryStats.innerHTML = `
                <div class="stat-card">
                    <div class="label">今日销售额</div>
                    <div class="value">¥${summary.todayRevenue.toFixed(2)}</div>
                </div>
                <div class="stat-card">
                    <div class="label">本月销售额</div>
                    <div class="value">¥${summary.monthRevenue.toFixed(2)}</div>
                </div>
                <div class="stat-card">
                    <div class="label">负责商品数</div>
                    <div class="value">${summary.productCount}</div>
                </div>
                <div class="stat-card">
                    <div class="label">待处理订单</div>
                    <div class="value">${summary.pendingOrders}</div>
                </div>
            `;
        }
        
        // 退出登录
        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('userId');
            localStorage.removeItem('userRole');
            localStorage.removeItem('userName');
            window.location.href = 'login.html';
        }
    </script>
</body>

</html>
